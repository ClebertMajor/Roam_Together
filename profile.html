<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roam Together – Profile</title>
  <link rel="stylesheet" href="css/profile.css" />
</head>

<body>

  <!-- ===== HEADER BAR ===== -->
  <header>
    <div class="logo-wrap">
      <img src="css/images/logo.png" class="logo" alt="Roam Together Logo">
    </div>

    <div class="nav-buttons">
  <a href="home.html">Home</a>
  <a href="explore.html">Explore</a>
  <button id="signOutBtn" class="signout-btn">Sign Out</button>
</div>

  </header>

  <!-- ===== PROFILE BOX ===== -->
  <div class="profile-container">
    <h1>My Profile</h1>

    <img id="preview" class="profile-pic" src="" alt="Profile Picture" />

    <input type="file" id="upload" accept="image/*" />

    <div class="user-info">
      <div><strong>Name:</strong> <span id="user-name">Loading...</span></div>
    <div class="style-row">
      <label for="trip-style"><strong>Travel Style:</strong></label>
      <select id="trip-style" name="style">
        <option value="" selected disabled>Select style</option>
        <option value="solo">Solo, independent</option>
        <option value="chill">Chill & beachy</option>
        <option value="adventure">Adventure & outdoors</option>
        <option value="luxury">Luxury & bougie</option>
        <option value="budget">Budget & backpacking</option>
        <option value="food">Food & culture focused</option>
      </select>
    </div>

    </div>

    <label for="bio"><strong>Bio:</strong></label>
    <textarea id="bio" placeholder="Write something about yourself..."></textarea>

   
    <div class="trip-info">
  <h2>Your Trip</h2>

 <label for="trip-destination"><strong>Destination:</strong></label>
<select id="trip-destination" name="location">
  <option value="" selected disabled>Add location</option>
  <option value="paris">Paris, France</option>
  <option value="tokyo">Tokyo, Japan</option>
  <option value="bali">Bali, Indonesia</option>
  <option value="rome">Rome, Italy</option>
  <option value="cancun">Cancún, Mexico</option>
  <option value="nyc">New York City, USA</option>
</select>

  <label for="trip-start"><strong>Start Date:</strong></label>
  <input type="date" id="trip-start">

  <label for="trip-end"><strong>End Date:</strong></label>
  <input type="date" id="trip-end">
</div>

 <button id="saveBtn">Save Profile</button>


  </div>

   <!-- ========================= -->
  <!--     FIREBASE MODULE       -->
  <!-- ========================= -->
 <script type="module">
  import { app, auth, db, storage } from "./js/firebaseConfig.js";

  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

  const upload = document.getElementById("upload");
  const preview = document.getElementById("preview");
  const userNameSpan = document.getElementById("user-name");
  const travelStyleInput = document.getElementById("trip-style");
  const bioTextarea = document.getElementById("bio");
  const saveBtn = document.getElementById("saveBtn");
  const signOutBtn = document.getElementById("signOutBtn");


  const destinationInput = document.getElementById("trip-destination");
  const startDateInput = document.getElementById("trip-start");
  const endDateInput = document.getElementById("trip-end");

  let currentUserId = null;
  let selectedImageFile = null;

  upload.addEventListener("change", function () {
    selectedImageFile = this.files[0];
    if (selectedImageFile) preview.src = URL.createObjectURL(selectedImageFile);
  });

  onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "home.html";
    currentUserId = user.uid;

    const docRef = doc(db, "users", currentUserId);
    const snap = await getDoc(docRef);

    if (snap.exists()) {
      const data = snap.data();
      userNameSpan.textContent = data.name || "Not set";
      travelStyleInput.value = data.travelStyle || "";
      bioTextarea.value = data.bio || "";

      destinationInput.value = data.destination || "";
      startDateInput.value = data.startDate || "";
      endDateInput.value = data.endDate || "";

      if (data.profilePicURL) preview.src = data.profilePicURL;
    }
  });

  saveBtn.addEventListener("click", async () => {
    if (!currentUserId) return alert("You must be logged in to save.");

    const userDocRef = doc(db, "users", currentUserId);

    const bio = bioTextarea.value.trim();
    const destination = destinationInput.value;
    const startDate = startDateInput.value;
    const endDate = endDateInput.value;
    const travelStyle = travelStyleInput.value;


    let profilePicURL = null;

    if (selectedImageFile) {
      const imageRef = ref(storage, `profilePictures/${currentUserId}/profile.jpg`);
      await uploadBytes(imageRef, selectedImageFile);
      profilePicURL = await getDownloadURL(imageRef);
    }

    await setDoc(
      userDocRef,
      {
        bio,
        destination,
        startDate,
        endDate,
        travelStyle,
        ...(profilePicURL ? { profilePicURL } : {})
      },
      { merge: true }
    );

    alert("Profile saved!");
  });
  
  import { signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  signOutBtn.addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "home.html";
  });

</script>


</body>
</html>
